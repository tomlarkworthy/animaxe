/// <reference path="../node_modules/rx/ts/rx.all.d.ts" />
/// <reference path="../types/node.d.ts" />
/// <reference path="../types/mocha.d.ts" />
/// <reference path="../types/should.d.ts" /> 
require('source-map-support').install();
require("should");
var Ax = require("../src/animaxe");
var Rx = require("rx");
var counterA = 0;
var counterB = 0;
function countA(time) {
    return Ax.take(time, Ax.draw(function (tick) {
        counterA++;
    }));
}
function countAthenCountB() {
    return Ax.take(1, Ax.draw(function (tick) {
        //console.log("countA");
        counterA++;
    })).then(Ax.take(1, Ax.draw(function (tick) {
        //console.log("countB");
        counterB++;
    })));
}
describe('toStreamNumber', function () {
    it('should return a stream with numerical input', function () {
        Ax.toStreamNumber(5).should.not.equal(5);
        Ax.toStreamNumber(5).should.have.property('next');
    });
});
describe('point', function () {
    it('should return a point', function () {
        Ax.point(5, 5).next().toString().should.equal([5, 5].toString());
    });
});
describe('then', function () {
    it('stops on time', function () {
        counterA = 0;
        counterB = 0;
        var downstream = new Rx.ReplaySubject();
        var anim = countA(2).then(countA(1));
        counterA.should.equal(0);
        var upstream = Rx.Observable.return(new Ax.DrawTick(null, 0)).repeat(10);
        anim.attach(0, upstream).subscribe(downstream);
        counterA.should.equal(3);
    });
    it('thens of thens nest', function () {
        counterA = 0;
        counterB = 0;
        var downstream = new Rx.ReplaySubject();
        var anim = countAthenCountB().then(countAthenCountB());
        counterA.should.equal(0);
        counterA.should.equal(0);
        var upstream = Rx.Observable.return(new Ax.DrawTick(null, 0)).repeat(10);
        anim.attach(0, upstream).subscribe(downstream);
        counterA.should.equal(2);
        counterB.should.equal(2);
    });
    it('thens do not over draw', function () {
        console.log("thens do not overdraw");
        counterA = 0;
        counterB = 0;
        var downstream = new Rx.ReplaySubject();
        var anim = countAthenCountB();
        counterA.should.equal(0);
        counterB.should.equal(0);
        var upstream = Rx.Observable.return(new Ax.DrawTick(null, 0)).repeat(1);
        anim.attach(0, upstream.tap(function (next) {
            console.log("upstream");
        })).tap(function (next) {
            console.log("downstream");
        }).subscribe(downstream);
        counterA.should.equal(1);
        counterB.should.equal(0);
    });
});
describe('loop', function () {
    it('repeats finite sequence', function () {
        counterA = 0;
        counterB = 0;
        var downstream = new Rx.ReplaySubject();
        var anim = Ax.loop(countA(2));
        counterA.should.equal(0);
        var upstream = Rx.Observable.return(new Ax.DrawTick(null, 0)).repeat(10);
        anim.attach(0, upstream).subscribe(downstream);
        counterA.should.equal(10);
    });
    it('repeats then', function () {
        counterA = 0;
        counterB = 0;
        var downstream = new Rx.ReplaySubject();
        var anim = Ax.loop(countAthenCountB());
        counterA.should.equal(0);
        var upstream = Rx.Observable.return(new Ax.DrawTick(null, 0)).repeat(10);
        anim.attach(0, upstream).subscribe(downstream);
        counterA.should.equal(5);
        counterB.should.equal(5);
    });
    it('repeats works with inner then', function () {
        counterA = 0;
        counterB = 0;
        var downstream = new Rx.ReplaySubject();
        var anim = Ax.loop(countAthenCountB());
        counterA.should.equal(0);
        var upstream = Rx.Observable.return(new Ax.DrawTick(null, 0)).repeat(5);
        anim.attach(0, upstream).subscribe(downstream);
        counterA.should.equal(3);
        counterB.should.equal(2);
    });
    it('passes on dt', function () {
        var upstream = Rx.Observable.return(new Ax.DrawTick(null, 0.1)).repeat(3);
        var expectedTime = Rx.Observable.from([0.1, 0.1, 0.1]);
        //var anim = Ax.assertClock(expectedTime, Ax.loop(Ax.assertClock(expectedTime, countAthenCountB())));
        var anim = Ax.assertDt(expectedTime, Ax.loop(countAthenCountB()));
        anim.attach(0, upstream).subscribeOnError(function (error) {
            throw error;
        });
    });
    it('should pass errors', function () {
        var upstream = Rx.Observable.return(new Ax.DrawTick(null, 0.1)).repeat(3);
        var expectedTime = Rx.Observable.from([0]);
        //var anim = Ax.assertClock(expectedTime, Ax.loop(Ax.assertClock(expectedTime, countAthenCountB())));
        var anim = Ax.assertDt(expectedTime, Ax.loop(countAthenCountB()));
        var seenError = false;
        anim.attach(0, upstream).subscribeOnError(function (error) {
            seenError = true;
        });
        seenError.should.eql(true);
    });
});
describe('sin', function () {
    var animator = new Ax.Animator(null);
    var ticker = new Rx.Subject();
    animator.ticker(ticker);
    it('should return a number immediately next tick', function () {
        var gotNumber = false;
        Ax.sin(1).next().should.equal(0);
    });
});
describe('assertClock', function () {
    var upstream = Rx.Observable.return(new Ax.DrawTick(null, 0.1)).repeat(3);
    it('should pass if right', function () {
        Ax.assertDt(Rx.Observable.from([0.1, 0.2, 0.3]), countA(1)).attach(0, upstream).subscribe();
    });
    it('should throw if wrong (number mismatch)', function () {
        try {
            Ax.assertDt(Rx.Observable.from([0]), countA(1)).attach(0, upstream).subscribe();
            throw null;
        }
        catch (err) {
            err.should.not.eql(null);
        }
    });
    it('should throw if wrong (length mismatch)', function () {
        try {
            Ax.assertDt(Rx.Observable.from([0.1, 0.2, 0.3, 0.4]), countA(1)).attach(0, upstream).subscribe();
            throw null;
        }
        catch (err) {
            err.should.not.eql(null);
        }
    });
    it('should throw if wrong (length mismatch)', function () {
        try {
            Ax.assertDt(Rx.Observable.from([0.1, 0.2]), countA(1)).attach(0, upstream).subscribe();
            throw null;
        }
        catch (err) {
            err.should.not.eql(null);
        }
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QudHMiXSwibmFtZXMiOlsiY291bnRBIiwiY291bnRBdGhlbkNvdW50QiJdLCJtYXBwaW5ncyI6IkFBQUEsQUFJQSwwREFKMEQ7QUFDMUQsMkNBQTJDO0FBQzNDLDRDQUE0QztBQUM1Qyw4Q0FBOEM7QUFDOUMsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDeEMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBRWxCLElBQU8sRUFBRSxXQUFXLGdCQUFnQixDQUFDLENBQUM7QUFDdEMsSUFBTyxFQUFFLFdBQVcsSUFBSSxDQUFDLENBQUM7QUFFMUIsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO0FBQ2pCLElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQztBQUNqQixnQkFBZ0IsSUFBVztJQUN2QkEsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsRUFBRUEsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsSUFBZ0JBO1FBQ25ELFFBQVEsRUFBRSxDQUFDO0lBQ2YsQ0FBQyxDQUFDQSxDQUFDQSxDQUFDQTtBQUNSQSxDQUFDQTtBQUVEO0lBQ0lDLE1BQU1BLENBQUNBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLElBQWdCQTtRQUNoRCxBQUNBLHdCQUR3QjtRQUN4QixRQUFRLEVBQUUsQ0FBQztJQUNmLENBQUMsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsSUFBZ0JBO1FBQ2xELEFBQ0Esd0JBRHdCO1FBQ3hCLFFBQVEsRUFBRSxDQUFDO0lBQ2YsQ0FBQyxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtBQUNUQSxDQUFDQTtBQUVELFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRTtJQUV2QixFQUFFLENB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InNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9ub2RlX21vZHVsZXMvcngvdHMvcnguYWxsLmQudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGVzL25vZGUuZC50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwZXMvbW9jaGEuZC50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwZXMvc2hvdWxkLmQudHNcIiAvPiBcbnJlcXVpcmUoJ3NvdXJjZS1tYXAtc3VwcG9ydCcpLmluc3RhbGwoKTtcbnJlcXVpcmUoXCJzaG91bGRcIik7XG5cbmltcG9ydCBBeCA9IHJlcXVpcmUoXCIuLi9zcmMvYW5pbWF4ZVwiKTtcbmltcG9ydCBSeCA9IHJlcXVpcmUoXCJyeFwiKTtcblxudmFyIGNvdW50ZXJBID0gMDtcbnZhciBjb3VudGVyQiA9IDA7XG5mdW5jdGlvbiBjb3VudEEodGltZTpudW1iZXIpOkF4LkFuaW1hdGlvbiB7IC8vd2UgY291bGQgYmUgY2xldmVyIGFuZCBsZXQgc3BhcmsgdGFrZSBhIHNlcSwgYnV0IHVzZXIgZnVuY3Rpb25zIHNob3VsZCBiZSBzaW1wbGVcbiAgICByZXR1cm4gQXgudGFrZSh0aW1lLCBBeC5kcmF3KGZ1bmN0aW9uICh0aWNrOkF4LkRyYXdUaWNrKSB7XG4gICAgICAgIGNvdW50ZXJBKys7XG4gICAgfSkpO1xufVxuXG5mdW5jdGlvbiBjb3VudEF0aGVuQ291bnRCKCk6QXguQW5pbWF0aW9uIHsgLy93ZSBjb3VsZCBiZSBjbGV2ZXIgYW5kIGxldCBzcGFyayB0YWtlIGEgc2VxLCBidXQgdXNlciBmdW5jdGlvbnMgc2hvdWxkIGJlIHNpbXBsZVxuICAgIHJldHVybiBBeC50YWtlKDEsIEF4LmRyYXcoZnVuY3Rpb24gKHRpY2s6QXguRHJhd1RpY2spIHtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImNvdW50QVwiKTtcbiAgICAgICAgY291bnRlckErKztcbiAgICB9KSkudGhlbihBeC50YWtlKDEsIEF4LmRyYXcoZnVuY3Rpb24gKHRpY2s6QXguRHJhd1RpY2spIHtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImNvdW50QlwiKTtcbiAgICAgICAgY291bnRlckIrKztcbiAgICB9KSkpO1xufVxuXG5kZXNjcmliZSgndG9TdHJlYW1OdW1iZXInLCBmdW5jdGlvbiAoKSB7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBhIHN0cmVhbSB3aXRoIG51bWVyaWNhbCBpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgQXgudG9TdHJlYW1OdW1iZXIoNSkuc2hvdWxkLm5vdC5lcXVhbCg1KTtcbiAgICAgICAgQXgudG9TdHJlYW1OdW1iZXIoNSkuc2hvdWxkLmhhdmUucHJvcGVydHkoJ25leHQnKTtcbiAgICB9KTtcbn0pO1xuZGVzY3JpYmUoJ3BvaW50JywgZnVuY3Rpb24gKCkge1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYSBwb2ludCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgQXgucG9pbnQoNSwgNSkubmV4dCgpLnRvU3RyaW5nKCkuc2hvdWxkLmVxdWFsKFs1LCA1XS50b1N0cmluZygpKTtcbiAgICB9KTtcbn0pO1xuXG5kZXNjcmliZSgndGhlbicsIGZ1bmN0aW9uICgpIHtcblxuICAgIGl0KCdzdG9wcyBvbiB0aW1lJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb3VudGVyQSA9IDA7XG4gICAgICAgIGNvdW50ZXJCID0gMDtcbiAgICAgICAgdmFyIGRvd25zdHJlYW0gPSBuZXcgUnguUmVwbGF5U3ViamVjdCgpO1xuICAgICAgICB2YXIgYW5pbSA9IGNvdW50QSgyKS50aGVuKGNvdW50QSgxKSk7XG4gICAgICAgIGNvdW50ZXJBLnNob3VsZC5lcXVhbCgwKTtcbiAgICAgICAgdmFyIHVwc3RyZWFtID0gUnguT2JzZXJ2YWJsZS5yZXR1cm4obmV3IEF4LkRyYXdUaWNrKG51bGwsIDApKS5yZXBlYXQoMTApO1xuICAgICAgICBhbmltLmF0dGFjaCgwLCB1cHN0cmVhbSkuc3Vic2NyaWJlKGRvd25zdHJlYW0pO1xuICAgICAgICBjb3VudGVyQS5zaG91bGQuZXF1YWwoMyk7XG4gICAgfSk7XG5cbiAgICBpdCgndGhlbnMgb2YgdGhlbnMgbmVzdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY291bnRlckEgPSAwO1xuICAgICAgICBjb3VudGVyQiA9IDA7XG4gICAgICAgIHZhciBkb3duc3RyZWFtID0gbmV3IFJ4LlJlcGxheVN1YmplY3QoKTtcbiAgICAgICAgdmFyIGFuaW0gPSBjb3VudEF0aGVuQ291bnRCKCkudGhlbihjb3VudEF0aGVuQ291bnRCKCkpO1xuICAgICAgICBjb3VudGVyQS5zaG91bGQuZXF1YWwoMCk7XG4gICAgICAgIGNvdW50ZXJBLnNob3VsZC5lcXVhbCgwKTtcbiAgICAgICAgdmFyIHVwc3RyZWFtID0gUnguT2JzZXJ2YWJsZS5yZXR1cm4obmV3IEF4LkRyYXdUaWNrKG51bGwsIDApKS5yZXBlYXQoMTApO1xuICAgICAgICBhbmltLmF0dGFjaCgwLCB1cHN0cmVhbSkuc3Vic2NyaWJlKGRvd25zdHJlYW0pO1xuICAgICAgICBjb3VudGVyQS5zaG91bGQuZXF1YWwoMik7XG4gICAgICAgIGNvdW50ZXJCLnNob3VsZC5lcXVhbCgyKTtcbiAgICB9KTtcblxuICAgIGl0KCd0aGVucyBkbyBub3Qgb3ZlciBkcmF3JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcInRoZW5zIGRvIG5vdCBvdmVyZHJhd1wiKTtcbiAgICAgICAgY291bnRlckEgPSAwO1xuICAgICAgICBjb3VudGVyQiA9IDA7XG4gICAgICAgIHZhciBkb3duc3RyZWFtID0gbmV3IFJ4LlJlcGxheVN1YmplY3QoKTtcbiAgICAgICAgdmFyIGFuaW0gPSBjb3VudEF0aGVuQ291bnRCKCk7XG4gICAgICAgIGNvdW50ZXJBLnNob3VsZC5lcXVhbCgwKTtcbiAgICAgICAgY291bnRlckIuc2hvdWxkLmVxdWFsKDApO1xuICAgICAgICB2YXIgdXBzdHJlYW0gPSBSeC5PYnNlcnZhYmxlLnJldHVybihuZXcgQXguRHJhd1RpY2sobnVsbCwgMCkpLnJlcGVhdCgxKTtcbiAgICAgICAgYW5pbS5hdHRhY2goMCwgdXBzdHJlYW0udGFwKGZ1bmN0aW9uIChuZXh0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInVwc3RyZWFtXCIpO1xuICAgICAgICB9KSkudGFwKGZ1bmN0aW9uIChuZXh0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImRvd25zdHJlYW1cIik7XG4gICAgICAgIH0pLnN1YnNjcmliZShkb3duc3RyZWFtKTtcbiAgICAgICAgY291bnRlckEuc2hvdWxkLmVxdWFsKDEpO1xuICAgICAgICBjb3VudGVyQi5zaG91bGQuZXF1YWwoMCk7XG4gICAgfSk7XG59KTtcblxuXG5kZXNjcmliZSgnbG9vcCcsIGZ1bmN0aW9uICgpIHtcblxuICAgIGl0KCdyZXBlYXRzIGZpbml0ZSBzZXF1ZW5jZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY291bnRlckEgPSAwO1xuICAgICAgICBjb3VudGVyQiA9IDA7XG4gICAgICAgIHZhciBkb3duc3RyZWFtID0gbmV3IFJ4LlJlcGxheVN1YmplY3QoKTtcbiAgICAgICAgdmFyIGFuaW0gPSBBeC5sb29wKGNvdW50QSgyKSk7XG4gICAgICAgIGNvdW50ZXJBLnNob3VsZC5lcXVhbCgwKTtcbiAgICAgICAgdmFyIHVwc3RyZWFtID0gUnguT2JzZXJ2YWJsZS5yZXR1cm4obmV3IEF4LkRyYXdUaWNrKG51bGwsIDApKS5yZXBlYXQoMTApO1xuICAgICAgICBhbmltLmF0dGFjaCgwLCB1cHN0cmVhbSkuc3Vic2NyaWJlKGRvd25zdHJlYW0pO1xuICAgICAgICBjb3VudGVyQS5zaG91bGQuZXF1YWwoMTApO1xuICAgIH0pO1xuICAgIGl0KCdyZXBlYXRzIHRoZW4nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvdW50ZXJBID0gMDtcbiAgICAgICAgY291bnRlckIgPSAwO1xuICAgICAgICB2YXIgZG93bnN0cmVhbSA9IG5ldyBSeC5SZXBsYXlTdWJqZWN0KCk7XG4gICAgICAgIHZhciBhbmltID0gQXgubG9vcChjb3VudEF0aGVuQ291bnRCKCkpO1xuICAgICAgICBjb3VudGVyQS5zaG91bGQuZXF1YWwoMCk7XG4gICAgICAgIHZhciB1cHN0cmVhbSA9IFJ4Lk9ic2VydmFibGUucmV0dXJuKG5ldyBBeC5EcmF3VGljayhudWxsLCAwKSkucmVwZWF0KDEwKTtcbiAgICAgICAgYW5pbS5hdHRhY2goMCwgdXBzdHJlYW0pLnN1YnNjcmliZShkb3duc3RyZWFtKTtcbiAgICAgICAgY291bnRlckEuc2hvdWxkLmVxdWFsKDUpO1xuICAgICAgICBjb3VudGVyQi5zaG91bGQuZXF1YWwoNSk7XG4gICAgfSk7XG4gICAgaXQoJ3JlcGVhdHMgd29ya3Mgd2l0aCBpbm5lciB0aGVuJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb3VudGVyQSA9IDA7XG4gICAgICAgIGNvdW50ZXJCID0gMDtcbiAgICAgICAgdmFyIGRvd25zdHJlYW0gPSBuZXcgUnguUmVwbGF5U3ViamVjdCgpO1xuICAgICAgICB2YXIgYW5pbSA9IEF4Lmxvb3AoY291bnRBdGhlbkNvdW50QigpKTtcbiAgICAgICAgY291bnRlckEuc2hvdWxkLmVxdWFsKDApO1xuICAgICAgICB2YXIgdXBzdHJlYW0gPSBSeC5PYnNlcnZhYmxlLnJldHVybihuZXcgQXguRHJhd1RpY2sobnVsbCwgMCkpLnJlcGVhdCg1KTtcbiAgICAgICAgYW5pbS5hdHRhY2goMCwgdXBzdHJlYW0pLnN1YnNjcmliZShkb3duc3RyZWFtKTtcbiAgICAgICAgY291bnRlckEuc2hvdWxkLmVxdWFsKDMpO1xuICAgICAgICBjb3VudGVyQi5zaG91bGQuZXF1YWwoMik7XG4gICAgfSk7XG5cbiAgICBpdCgncGFzc2VzIG9uIGR0JywgZnVuY3Rpb24gKCkgeyAvL3RvZG8gZ2VuZXJpYyBhbmltYXRpb24gY29udHJhY3RcblxuICAgICAgICB2YXIgdXBzdHJlYW0gPSBSeC5PYnNlcnZhYmxlLnJldHVybihuZXcgQXguRHJhd1RpY2sobnVsbCwgMC4xKSkucmVwZWF0KDMpO1xuICAgICAgICB2YXIgZXhwZWN0ZWRUaW1lID0gUnguT2JzZXJ2YWJsZS5mcm9tKFswLjEsIDAuMSwgMC4xXSk7XG4gICAgICAgIC8vdmFyIGFuaW0gPSBBeC5hc3NlcnRDbG9jayhleHBlY3RlZFRpbWUsIEF4Lmxvb3AoQXguYXNzZXJ0Q2xvY2soZXhwZWN0ZWRUaW1lLCBjb3VudEF0aGVuQ291bnRCKCkpKSk7XG4gICAgICAgIHZhciBhbmltID0gQXguYXNzZXJ0RHQoZXhwZWN0ZWRUaW1lLCBBeC5sb29wKGNvdW50QXRoZW5Db3VudEIoKSkpO1xuICAgICAgICBhbmltLmF0dGFjaCgwLCB1cHN0cmVhbSkuc3Vic2NyaWJlT25FcnJvcihcbiAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwYXNzIGVycm9ycycsIGZ1bmN0aW9uICgpIHsgLy90b2RvIGdlbmVyaWMgYW5pbWF0aW9uIGNvbnRyYWN0XG4gICAgICAgIHZhciB1cHN0cmVhbSA9IFJ4Lk9ic2VydmFibGUucmV0dXJuKG5ldyBBeC5EcmF3VGljayhudWxsLCAwLjEpKS5yZXBlYXQoMyk7XG4gICAgICAgIHZhciBleHBlY3RlZFRpbWUgPSBSeC5PYnNlcnZhYmxlLmZyb20oWzBdKTtcbiAgICAgICAgLy92YXIgYW5pbSA9IEF4LmFzc2VydENsb2NrKGV4cGVjdGVkVGltZSwgQXgubG9vcChBeC5hc3NlcnRDbG9jayhleHBlY3RlZFRpbWUsIGNvdW50QXRoZW5Db3VudEIoKSkpKTtcbiAgICAgICAgdmFyIGFuaW0gPSBBeC5hc3NlcnREdChleHBlY3RlZFRpbWUsIEF4Lmxvb3AoY291bnRBdGhlbkNvdW50QigpKSk7XG4gICAgICAgIHZhciBzZWVuRXJyb3IgPSBmYWxzZTtcbiAgICAgICAgYW5pbS5hdHRhY2goMCwgdXBzdHJlYW0pLnN1YnNjcmliZU9uRXJyb3IoXG4gICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBzZWVuRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICBzZWVuRXJyb3Iuc2hvdWxkLmVxbCh0cnVlKTtcbiAgICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnc2luJywgZnVuY3Rpb24gKCkge1xuICAgIHZhciBhbmltYXRvciA9IG5ldyBBeC5BbmltYXRvcihudWxsKTtcbiAgICB2YXIgdGlja2VyID0gbmV3IFJ4LlN1YmplY3Q8bnVtYmVyPigpO1xuICAgIGFuaW1hdG9yLnRpY2tlcih0aWNrZXIpO1xuXG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBhIG51bWJlciBpbW1lZGlhdGVseSBuZXh0IHRpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBnb3ROdW1iZXIgPSBmYWxzZTtcbiAgICAgICAgQXguc2luKDEpLm5leHQoKS5zaG91bGQuZXF1YWwoMCk7XG4gICAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ2Fzc2VydENsb2NrJywgZnVuY3Rpb24gKCkge1xuICAgIHZhciB1cHN0cmVhbSA9IFJ4Lk9ic2VydmFibGUucmV0dXJuKG5ldyBBeC5EcmF3VGljayhudWxsLCAwLjEpKS5yZXBlYXQoMyk7XG4gICAgaXQoJ3Nob3VsZCBwYXNzIGlmIHJpZ2h0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBBeC5hc3NlcnREdChSeC5PYnNlcnZhYmxlLmZyb20oWzAuMSwgMC4yLCAwLjNdKSwgY291bnRBKDEpKS5hdHRhY2goMCwgdXBzdHJlYW0pLnN1YnNjcmliZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBpZiB3cm9uZyAobnVtYmVyIG1pc21hdGNoKScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIEF4LmFzc2VydER0KFJ4Lk9ic2VydmFibGUuZnJvbShbMF0pLCBjb3VudEEoMSkpLmF0dGFjaCgwLCB1cHN0cmVhbSkuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB0aHJvdyBudWxsO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGVyci5zaG91bGQubm90LmVxbChudWxsKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGhyb3cgaWYgd3JvbmcgKGxlbmd0aCBtaXNtYXRjaCknLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBBeC5hc3NlcnREdChSeC5PYnNlcnZhYmxlLmZyb20oWzAuMSwgMC4yLCAwLjMsIDAuNF0pLCBjb3VudEEoMSkpLmF0dGFjaCgwLCB1cHN0cmVhbSkuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB0aHJvdyBudWxsO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGVyci5zaG91bGQubm90LmVxbChudWxsKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGhyb3cgaWYgd3JvbmcgKGxlbmd0aCBtaXNtYXRjaCknLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBBeC5hc3NlcnREdChSeC5PYnNlcnZhYmxlLmZyb20oWzAuMSwgMC4yXSksIGNvdW50QSgxKSkuYXR0YWNoKDAsIHVwc3RyZWFtKS5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIHRocm93IG51bGw7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgZXJyLnNob3VsZC5ub3QuZXFsKG51bGwpO1xuICAgICAgICB9XG4gICAgfSk7XG59KTtcblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9