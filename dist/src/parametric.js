/**
 * Defines utilities for working with parametric function, e.g. x = sin(t), y = cos(t) where t = 0 ... 10
 */
function evaluate(equations, t) {
    return equations.map(function (fn) { return fn(t); });
}
function midpoint(a, b) {
    return a.map(function (v, index) { return (v + b[index]) / 2; });
}
function add(a, b) {
    return a + b;
}
function distance2(a, b) {
    return a.map(function (v, index) { return (v - b[index]) * (v - b[index]); }).reduce(add, 0);
}
function trace(equations, t_min, t_max, tolerance_px2, minimum_splits, maximum_splits, t_min_value, t_max_value) {
    // console.log(minimum_splits, maximum_splits);
    if (tolerance_px2 === void 0) { tolerance_px2 = 1; }
    if (minimum_splits === void 0) { minimum_splits = 4; }
    if (maximum_splits === void 0) { maximum_splits = 100; }
    // figure out the start and end point if not provided
    var min = t_min_value || evaluate(equations, t_min);
    var max = t_max_value || evaluate(equations, t_max);
    var t_mid = (t_min + t_max) / 2;
    var mid_predict = midpoint(min, max); // guess the mid point based on linear interpolation
    var mid_actual = evaluate(equations, t_mid); // get the real midpoint from the equations
    // the distance between predicted and actuall is our error term
    var dist2 = distance2(mid_predict, mid_actual);
    var result = [];
    // if the caller did not specify the min_value, they will want to see it in the result set
    if (!t_min_value)
        result.push({ point: min, t: t_min });
    if ((dist2 < tolerance_px2 && minimum_splits <= 0) || maximum_splits <= 0) {
    }
    else {
        // high error,
        // we recurse by dividing the problem into 2 smaller tracing problems
        minimum_splits = Math.ceil((minimum_splits - 1) / 2);
        maximum_splits = Math.ceil((maximum_splits - 1) / 2);
        result = result.concat(trace(equations, t_min, t_mid, tolerance_px2, minimum_splits, maximum_splits, min, mid_actual));
        result.push({ point: mid_actual, t: t_mid });
        result = result.concat(trace(equations, t_mid, t_max, tolerance_px2, minimum_splits, maximum_splits, mid_actual, max));
    }
    // if the caller did not specify the max_value, they will want to see it in the result set
    if (!t_max_value)
        result.push({ point: max, t: t_max });
    // console.log(result);
    return result;
}
exports.trace = trace;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9wYXJhbWV0cmljLnRzIl0sIm5hbWVzIjpbImV2YWx1YXRlIiwibWlkcG9pbnQiLCJhZGQiLCJkaXN0YW5jZTIiLCJ0cmFjZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0dBRUc7QUFFSCxrQkFBa0IsU0FBb0MsRUFBRSxDQUFTO0lBQzdEQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFBQSxFQUFFQSxJQUFJQSxPQUFBQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFMQSxDQUFLQSxDQUFDQSxDQUFDQTtBQUN0Q0EsQ0FBQ0E7QUFDRCxrQkFBa0IsQ0FBVyxFQUFFLENBQVc7SUFDdENDLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLFVBQUNBLENBQUNBLEVBQUVBLEtBQUtBLElBQUtBLE9BQUFBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQWxCQSxDQUFrQkEsQ0FBQ0EsQ0FBQ0E7QUFDbkRBLENBQUNBO0FBQ0QsYUFBYSxDQUFTLEVBQUUsQ0FBUztJQUM3QkMsTUFBTUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7QUFDakJBLENBQUNBO0FBQ0QsbUJBQW1CLENBQVcsRUFBRSxDQUFXO0lBQ3ZDQyxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFDQSxDQUFDQSxFQUFFQSxLQUFLQSxJQUFLQSxPQUFBQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxFQUEvQkEsQ0FBK0JBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO0FBQy9FQSxDQUFDQTtBQUVELGVBQ0ksU0FBb0MsRUFDcEMsS0FBYSxFQUNiLEtBQWEsRUFDYixhQUF5QixFQUN6QixjQUFrQixFQUNsQixjQUFvQixFQUNwQixXQUF1QixFQUN2QixXQUF1QjtJQUd2QkMsK0NBQStDQTtJQVAvQ0EsNkJBQXlCQSxHQUF6QkEsaUJBQXlCQTtJQUN6QkEsOEJBQWtCQSxHQUFsQkEsa0JBQWtCQTtJQUNsQkEsOEJBQW9CQSxHQUFwQkEsb0JBQW9CQTtJQU9wQkEscURBQXFEQTtJQUNyREEsSUFBSUEsR0FBR0EsR0FBR0EsV0FBV0EsSUFBSUEsUUFBUUEsQ0FBQ0EsU0FBU0EsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7SUFDcERBLElBQUlBLEdBQUdBLEdBQUdBLFdBQVdBLElBQUlBLFFBQVFBLENBQUNBLFNBQVNBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO0lBRXBEQSxJQUFJQSxLQUFLQSxHQUFHQSxDQUFDQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUNoQ0EsSUFBSUEsV0FBV0EsR0FBR0EsUUFBUUEsQ0FBQ0EsR0FBR0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBRUEsb0RBQW9EQTtJQUMzRkEsSUFBSUEsVUFBVUEsR0FBR0EsUUFBUUEsQ0FBQ0EsU0FBU0EsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsMkNBQTJDQTtJQUV4RkEsK0RBQStEQTtJQUMvREEsSUFBSUEsS0FBS0EsR0FBR0EsU0FBU0EsQ0FBQ0EsV0FBV0EsRUFBRUEsVUFBVUEsQ0FBQ0EsQ0FBQUE7SUFFOUNBLElBQUlBLE1BQU1BLEdBQUdBLEVBQUVBLENBQUNBO0lBQ2hCQSwwRkFBMEZBO0lBQzFGQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxXQUFXQSxDQUFDQTtRQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxFQUFDQSxLQUFLQSxFQUFFQSxHQUFHQSxFQUFFQSxDQUFDQSxFQUFFQSxLQUFLQSxFQUFDQSxDQUFDQSxDQUFDQTtJQUN0REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsR0FBR0EsYUFBYUEsSUFBSUEsY0FBY0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsY0FBY0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFHNUVBLENBQUNBO0lBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ0pBLGNBQWNBO1FBQ2RBLHFFQUFxRUE7UUFDckVBLGNBQWNBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLGNBQWNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUFBO1FBQ3BEQSxjQUFjQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxjQUFjQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFBQTtRQUNwREEsTUFBTUEsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsRUFBRUEsS0FBS0EsRUFBRUEsS0FBS0EsRUFBRUEsYUFBYUEsRUFBRUEsY0FBY0EsRUFBRUEsY0FBY0EsRUFBRUEsR0FBR0EsRUFBRUEsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDdkhBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLEVBQUNBLEtBQUtBLEVBQUVBLFVBQVVBLEVBQUVBLENBQUNBLEVBQUVBLEtBQUtBLEVBQUNBLENBQUNBLENBQUNBO1FBQzNDQSxNQUFNQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxTQUFTQSxFQUFFQSxLQUFLQSxFQUFFQSxLQUFLQSxFQUFFQSxhQUFhQSxFQUFFQSxjQUFjQSxFQUFFQSxjQUFjQSxFQUFFQSxVQUFVQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUMzSEEsQ0FBQ0E7SUFDREEsMEZBQTBGQTtJQUMxRkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsV0FBV0EsQ0FBQ0E7UUFBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBQ0EsS0FBS0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsRUFBRUEsS0FBS0EsRUFBQ0EsQ0FBQ0EsQ0FBQ0E7SUFFdERBLHVCQUF1QkE7SUFDdkJBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO0FBQ2xCQSxDQUFDQTtBQTVDZSxhQUFLLFFBNENwQixDQUFBIiwiZmlsZSI6InNyYy9wYXJhbWV0cmljLmpzIiwic291cmNlc0NvbnRlbnQiOltudWxsXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
