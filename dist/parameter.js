exports.DEBUG = false;
/**
 * convert an Rx.Observable into a Parameter by providing an initial value. The Parameter's value will update its value
 * every time and event is received from the Rx source
 */
function updateFrom(initialValue, source) {
    return new Parameter(function () {
        var value = initialValue;
        source.subscribe(function (x) { return value = x; });
        return function (clock) {
            return value;
        };
    });
}
exports.updateFrom = updateFrom;
/**
 * convert an Rx.Observable into a Parameter by providing an default value. The Parameter's value will be replaced
 * with the value from the provided Rx.Observable for one tick only
 */
function overwriteWith(defaultValue, source) {
    return new Parameter(function () {
        var value = defaultValue;
        source.subscribe(function (x) { return value = x; });
        return function (clock) {
            var returnValue = value;
            value = defaultValue; // reset value each time
            return returnValue;
        };
    });
}
exports.overwriteWith = overwriteWith;
var Parameter = (function () {
    /**
     * Before a parameter is used, the enclosing animation must call init. This returns a function which
     * can be used to find the value of the function for specific values of time.
     */
    function Parameter(init) {
        this.init = init;
    }
    /**
     * Before a parameter is used, the enclosing animation must call init. This returns a function which
     * can be used to find the value of the function for specific values of time.
     */
    Parameter.prototype.init = function () { throw new Error('This method is abstract'); };
    /**
     * map the value of 'this' to a new parameter
     */
    Parameter.prototype.map = function (fn) {
        var base = this;
        return new Parameter(function () {
            var base_next = base.init();
            return function (t) {
                return fn(base_next(t));
            };
        });
    };
    /**
     * Returns a parameter whose value is forever the first value next picked from this.
     * @returns {Parameter<T>}
     */
    Parameter.prototype.first = function () {
        var self = this;
        return new Parameter(function () {
            var generate = true;
            var next = self.init();
            var value = null;
            return function (clock) {
                if (generate) {
                    generate = false;
                    value = next(clock);
                }
                // console.log("fixed: val from parameter", value);
                return value;
            };
        });
    };
    return Parameter;
})();
exports.Parameter = Parameter;
function from(source) {
    if (typeof source.init == 'function')
        return source;
    else
        return constant(source);
}
exports.from = from;
function point(x, y) {
    return new Parameter(function () {
        var x_next = from(x).init();
        var y_next = from(y).init();
        return function (t) {
            var result = [x_next(t), y_next(t)];
            //if (DEBUG) console.log("point: next", result);
            return result;
        };
    });
}
exports.point = point;
function displaceT(displacement, value) {
    return new Parameter(function () {
        var dt_next = from(displacement).init();
        var value_next = from(value).init();
        return function (t) {
            var dt = dt_next(t);
            if (exports.DEBUG)
                console.log("displaceT: ", dt);
            return value_next(t + dt);
        };
    });
}
exports.displaceT = displaceT;
/*
    RGB between 0 and 255
    a between 0 - 1
 */
function rgba(r, g, b, a) {
    return new Parameter(function () {
        var r_next = from(r).init();
        var g_next = from(g).init();
        var b_next = from(b).init();
        var a_next = from(a).init();
        return function (t) {
            var r_val = Math.floor(r_next(t));
            var g_val = Math.floor(g_next(t));
            var b_val = Math.floor(b_next(t));
            var a_val = a_next(t);
            var val = "rgba(" + r_val + "," + g_val + "," + b_val + "," + a_val + ")";
            if (exports.DEBUG)
                console.log("color: ", val);
            return val;
        };
    });
}
exports.rgba = rgba;
function hsl(h, s, l) {
    return new Parameter(function () {
        var h_next = from(h).init();
        var s_next = from(s).init();
        var l_next = from(l).init();
        return function (t) {
            var h_val = Math.floor(h_next(t));
            var s_val = Math.floor(s_next(t));
            var l_val = Math.floor(l_next(t));
            var val = "hsl(" + h_val + "," + s_val + "%," + l_val + "%)";
            // if (DEBUG) console.log("hsl: ", val);
            return val;
        };
    });
}
exports.hsl = hsl;
function t() {
    return new Parameter(function () { return function (t) {
        return t;
    }; });
}
exports.t = t;
function rnd() {
    return new Parameter(function () { return function (t) {
        return Math.random();
    }; });
}
exports.rnd = rnd;
function constant(val) {
    return new Parameter(function () { return function (t) {
        return val;
    }; });
}
exports.constant = constant;
function rndNormal(scale) {
    if (scale === void 0) { scale = 1; }
    return new Parameter(function () {
        if (exports.DEBUG)
            console.log("rndNormal: init");
        var scale_next = from(scale).init();
        return function (t) {
            var scale = scale_next(t);
            // generate random numbers
            var norm2 = 100;
            while (norm2 > 1) {
                var x = (Math.random() - 0.5) * 2;
                var y = (Math.random() - 0.5) * 2;
                norm2 = x * x + y * y;
            }
            var norm = Math.sqrt(norm2);
            var val = [scale * x / norm, scale * y / norm];
            if (exports.DEBUG)
                console.log("rndNormal: val", val);
            return val;
        };
    });
}
exports.rndNormal = rndNormal;
//todo: should be t as a parameter to a non tempor
function sin(period) {
    if (exports.DEBUG)
        console.log("sin: new");
    return new Parameter(function () {
        var period_next = from(period).init();
        return function (t) {
            var value = Math.sin(t * (Math.PI * 2) / period_next(t));
            if (exports.DEBUG)
                console.log("sin: tick", t, value);
            return value;
        };
    });
}
exports.sin = sin;
function cos(period) {
    if (exports.DEBUG)
        console.log("cos: new");
    return new Parameter(function () {
        var period_next = from(period).init();
        return function (t) {
            var value = Math.cos(t * (Math.PI * 2) / period_next(t));
            if (exports.DEBUG)
                console.log("cos: tick", t, value);
            return value;
        };
    });
}
exports.cos = cos;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcmFtZXRlci50cyJdLCJuYW1lcyI6WyJ1cGRhdGVGcm9tIiwib3ZlcndyaXRlV2l0aCIsIlBhcmFtZXRlciIsIlBhcmFtZXRlci5jb25zdHJ1Y3RvciIsIlBhcmFtZXRlci5pbml0IiwiUGFyYW1ldGVyLm1hcCIsIlBhcmFtZXRlci5maXJzdCIsImZyb20iLCJwb2ludCIsImRpc3BsYWNlVCIsInJnYmEiLCJoc2wiLCJ0Iiwicm5kIiwiY29uc3RhbnQiLCJybmROb3JtYWwiLCJzaW4iLCJjb3MiXSwibWFwcGluZ3MiOiJBQUlXLGFBQUssR0FBRyxLQUFLLENBQUM7QUFTekI7OztHQUdHO0FBQ0gsb0JBQThCLFlBQWUsRUFBRSxNQUF3QjtJQUNuRUEsTUFBTUEsQ0FBQ0EsSUFBSUEsU0FBU0EsQ0FDaEJBO1FBQ0lBLElBQUlBLEtBQUtBLEdBQUdBLFlBQVlBLENBQUNBO1FBQ3pCQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxVQUFBQSxDQUFDQSxJQUFJQSxPQUFBQSxLQUFLQSxHQUFHQSxDQUFDQSxFQUFUQSxDQUFTQSxDQUFDQSxDQUFDQTtRQUNqQ0EsTUFBTUEsQ0FBQ0EsVUFBQ0EsS0FBYUE7WUFDakJBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBO1FBQ2pCQSxDQUFDQSxDQUFBQTtJQUNMQSxDQUFDQSxDQUNKQSxDQUFDQTtBQUNOQSxDQUFDQTtBQVZlLGtCQUFVLGFBVXpCLENBQUE7QUFFRDs7O0dBR0c7QUFDSCx1QkFBaUMsWUFBZSxFQUFFLE1BQXdCO0lBQ3RFQyxNQUFNQSxDQUFDQSxJQUFJQSxTQUFTQSxDQUNoQkE7UUFDSUEsSUFBSUEsS0FBS0EsR0FBR0EsWUFBWUEsQ0FBQ0E7UUFDekJBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBLFVBQUFBLENBQUNBLElBQUlBLE9BQUFBLEtBQUtBLEdBQUdBLENBQUNBLEVBQVRBLENBQVNBLENBQUNBLENBQUNBO1FBQ2pDQSxNQUFNQSxDQUFDQSxVQUFDQSxLQUFhQTtZQUNqQkEsSUFBSUEsV0FBV0Es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QSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQTtRQUN0Q0EsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBU0E7WUFDdEIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pELEVBQUUsQ0FBQyxDQUFDLGFBQUssQ0FBQztnQkFBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDOUMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUNqQixDQUFDLENBQUFBO0lBQ0xBLENBQUNBLENBQ0pBLENBQUNBO0FBQ05BLENBQUNBO0FBWmUsV0FBRyxNQVlsQixDQUFBIiwiZmlsZSI6InBhcmFtZXRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9ub2RlX21vZHVsZXMvcngvdHMvcnguYWxsLmQudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGVzL25vZGUuZC50c1wiIC8+XG5pbXBvcnQgUnggPSByZXF1aXJlKCdyeCcpO1xuXG5leHBvcnQgdmFyIERFQlVHID0gZmFsc2U7XG5cbi8vIHRvZG8gdGhlc2UgY2hvdWxkIGJlIHB1dCBpbiB0eXBlcyBFUzYgbW9kdWxlIGJ1dCBteSBJREUgZG9lcyBub3Qgc3VwcG9ydCBpdCB5ZXQgKHB5Y2hhcm0pXG5leHBvcnQgdHlwZSBDb2xvciA9IHN0cmluZ1xuZXhwb3J0IHR5cGUgUG9pbnQgICAgID0gW251bWJlciwgbnVtYmVyXVxuZXhwb3J0IHR5cGUgTnVtYmVyQXJnID0gbnVtYmVyIHwgUGFyYW1ldGVyPG51bWJlcj5cbmV4cG9ydCB0eXBlIFBvaW50QXJnICA9IFBvaW50IHwgUGFyYW1ldGVyPFBvaW50PlxuXG5cbi8qKlxuICogY29udmVydCBhbiBSeC5PYnNlcnZhYmxlIGludG8gYSBQYXJhbWV0ZXIgYnkgcHJvdmlkaW5nIGFuIGluaXRpYWwgdmFsdWUuIFRoZSBQYXJhbWV0ZXIncyB2YWx1ZSB3aWxsIHVwZGF0ZSBpdHMgdmFsdWVcbiAqIGV2ZXJ5IHRpbWUgYW5kIGV2ZW50IGlzIHJlY2VpdmVkIGZyb20gdGhlIFJ4IHNvdXJjZVxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlRnJvbTxUPihpbml0aWFsVmFsdWU6IFQsIHNvdXJjZTogUnguT2JzZXJ2YWJsZTxUPik6IFBhcmFtZXRlcjxUPiB7XG4gICAgcmV0dXJuIG5ldyBQYXJhbWV0ZXIoXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGluaXRpYWxWYWx1ZTtcbiAgICAgICAgICAgIHNvdXJjZS5zdWJzY3JpYmUoeCA9PiB2YWx1ZSA9IHgpO1xuICAgICAgICAgICAgcmV0dXJuIChjbG9jazogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgKTtcbn1cblxuLyoqXG4gKiBjb252ZXJ0IGFuIFJ4Lk9ic2VydmFibGUgaW50byBhIFBhcmFtZXRlciBieSBwcm92aWRpbmcgYW4gZGVmYXVsdCB2YWx1ZS4gVGhlIFBhcmFtZXRlcidzIHZhbHVlIHdpbGwgYmUgcmVwbGFjZWRcbiAqIHdpdGggdGhlIHZhbHVlIGZyb20gdGhlIHByb3ZpZGVkIFJ4Lk9ic2VydmFibGUgZm9yIG9uZSB0aWNrIG9ubHlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG92ZXJ3cml0ZVdpdGg8VD4oZGVmYXVsdFZhbHVlOiBULCBzb3VyY2U6IFJ4Lk9ic2VydmFibGU8VD4pOiBQYXJhbWV0ZXI8VD4ge1xuICAgIHJldHVybiBuZXcgUGFyYW1ldGVyKFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBkZWZhdWx0VmFsdWU7XG4gICAgICAgICAgICBzb3VyY2Uuc3Vic2NyaWJlKHggPT4gdmFsdWUgPSB4KTtcbiAgICAgICAgICAgIHJldHVybiAoY2xvY2s6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgICAgIHZhciByZXR1cm5WYWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIHZhbHVlID0gZGVmYXVsdFZhbHVlOyAvLyByZXNldCB2YWx1ZSBlYWNoIHRpbWVcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICApO1xufVxuXG5cbmV4cG9ydCBjbGFzcyBQYXJhbWV0ZXI8VmFsdWU+IHtcbiAgICAvKipcbiAgICAgKiBCZWZvcmUgYSBwYXJhbWV0ZXIgaXMgdXNlZCwgdGhlIGVuY2xvc2luZyBhbmltYXRpb24gbXVzdCBjYWxsIGluaXQuIFRoaXMgcmV0dXJucyBhIGZ1bmN0aW9uIHdoaWNoXG4gICAgICogY2FuIGJlIHVzZWQgdG8gZmluZCB0aGUgdmFsdWUgb2YgdGhlIGZ1bmN0aW9uIGZvciBzcGVjaWZpYyB2YWx1ZXMgb2YgdGltZS5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihpbml0OiAoKSA9PiAoKGNsb2NrOiBudW1iZXIpID0+IFZhbHVlKSkge1xuICAgICAgICB0aGlzLmluaXQgPSBpbml0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJlZm9yZSBhIHBhcmFtZXRlciBpcyB1c2VkLCB0aGUgZW5jbG9zaW5nIGFuaW1hdGlvbiBtdXN0IGNhbGwgaW5pdC4gVGhpcyByZXR1cm5zIGEgZnVuY3Rpb24gd2hpY2hcbiAgICAgKiBjYW4gYmUgdXNlZCB0byBmaW5kIHRoZSB2YWx1ZSBvZiB0aGUgZnVuY3Rpb24gZm9yIHNwZWNpZmljIHZhbHVlcyBvZiB0aW1lLlxuICAgICAqL1xuICAgIGluaXQoKTogKGNsb2NrOiBudW1iZXIpID0+IFZhbHVlIHt0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbWV0aG9kIGlzIGFic3RyYWN0Jyk7fVxuXG4gICAgLyoqXG4gICAgICogbWFwIHRoZSB2YWx1ZSBvZiAndGhpcycgdG8gYSBuZXcgcGFyYW1ldGVyXG4gICAgICovXG4gICAgbWFwPFY+KGZuOiAoVmFsdWUpID0+IFYpOiBQYXJhbWV0ZXI8Vj4ge1xuICAgICAgICB2YXIgYmFzZSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUGFyYW1ldGVyKFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBiYXNlX25leHQgPSBiYXNlLmluaXQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm4oYmFzZV9uZXh0KHQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBwYXJhbWV0ZXIgd2hvc2UgdmFsdWUgaXMgZm9yZXZlciB0aGUgZmlyc3QgdmFsdWUgbmV4dCBwaWNrZWQgZnJvbSB0aGlzLlxuICAgICAqIEByZXR1cm5zIHtQYXJhbWV0ZXI8VD59XG4gICAgICovXG4gICAgZmlyc3QoKTogUGFyYW1ldGVyPFZhbHVlPiB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQYXJhbWV0ZXI8VmFsdWU+KFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBnZW5lcmF0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdmFyIG5leHQgPSBzZWxmLmluaXQoKTtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoY2xvY2s6IG51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ2VuZXJhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG5leHQoY2xvY2spO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZml4ZWQ6IHZhbCBmcm9tIHBhcmFtZXRlclwiLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGZyb208VD4oc291cmNlOiBUIHwgUGFyYW1ldGVyPFQ+KTogUGFyYW1ldGVyPFQ+IHtcbiAgICBpZiAodHlwZW9mICg8YW55PnNvdXJjZSkuaW5pdCA9PSAnZnVuY3Rpb24nKSByZXR1cm4gPFBhcmFtZXRlcjxUPj5zb3VyY2U7XG4gICAgZWxzZSByZXR1cm4gY29uc3RhbnQoPFQ+IHNvdXJjZSlcbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gcG9pbnQoXG4gICAgeDogbnVtYmVyIHwgUGFyYW1ldGVyPG51bWJlcj4sXG4gICAgeTogbnVtYmVyIHwgUGFyYW1ldGVyPG51bWJlcj5cbik6IFBhcmFtZXRlcjxQb2ludD5cbnsgICAvL2lmIChERUJVRykgY29uc29sZS5sb2coXCJwb2ludDogaW5pdFwiLCB4X3N0cmVhbSwgeV9zdHJlYW0pO1xuICAgIHJldHVybiBuZXcgUGFyYW1ldGVyKFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgeF9uZXh0ID0gZnJvbSh4KS5pbml0KCk7XG4gICAgICAgICAgICB2YXIgeV9uZXh0ID0gZnJvbSh5KS5pbml0KCk7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odDogbnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdDogW251bWJlciwgbnVtYmVyXSA9IFt4X25leHQodCksIHlfbmV4dCh0KV07XG4gICAgICAgICAgICAgICAgLy9pZiAoREVCVUcpIGNvbnNvbGUubG9nKFwicG9pbnQ6IG5leHRcIiwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgKTtcbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gZGlzcGxhY2VUPFQ+KGRpc3BsYWNlbWVudDogTnVtYmVyQXJnLCB2YWx1ZTogVCB8IFBhcmFtZXRlcjxUPik6IFBhcmFtZXRlcjxUPiB7XG4gICAgcmV0dXJuIG5ldyBQYXJhbWV0ZXI8VD4gKFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgZHRfbmV4dCAgICA9IGZyb20oZGlzcGxhY2VtZW50KS5pbml0KCk7XG4gICAgICAgICAgICB2YXIgdmFsdWVfbmV4dCA9IGZyb20odmFsdWUpLmluaXQoKTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgIHZhciBkdCA9IGR0X25leHQodCk7XG4gICAgICAgICAgICAgICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhcImRpc3BsYWNlVDogXCIsIGR0KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVfbmV4dCh0ICsgZHQpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICApXG59XG5cbi8qXG4gICAgUkdCIGJldHdlZW4gMCBhbmQgMjU1XG4gICAgYSBiZXR3ZWVuIDAgLSAxXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZ2JhKFxuICAgIHI6IG51bWJlciB8IFBhcmFtZXRlcjxudW1iZXI+LFxuICAgIGc6IG51bWJlciB8IFBhcmFtZXRlcjxudW1iZXI+LFxuICAgIGI6IG51bWJlciB8IFBhcmFtZXRlcjxudW1iZXI+LFxuICAgIGE6IG51bWJlciB8IFBhcmFtZXRlcjxudW1iZXI+XG4pOiBQYXJhbWV0ZXI8Q29sb3I+XG57XG4gICAgcmV0dXJuIG5ldyBQYXJhbWV0ZXIoXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICAgIHZhciByX25leHQgPSBmcm9tKHIpLmluaXQoKTtcbiAgICAgICAgICAgIHZhciBnX25leHQgPSBmcm9tKGcpLmluaXQoKTtcbiAgICAgICAgICAgIHZhciBiX25leHQgPSBmcm9tKGIpLmluaXQoKTtcbiAgICAgICAgICAgIHZhciBhX25leHQgPSBmcm9tKGEpLmluaXQoKTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0OiBudW1iZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgcl92YWwgPSBNYXRoLmZsb29yKHJfbmV4dCh0KSk7XG4gICAgICAgICAgICAgICAgdmFyIGdfdmFsID0gTWF0aC5mbG9vcihnX25leHQodCkpO1xuICAgICAgICAgICAgICAgIHZhciBiX3ZhbCA9IE1hdGguZmxvb3IoYl9uZXh0KHQpKTtcbiAgICAgICAgICAgICAgICB2YXIgYV92YWwgPSBhX25leHQodCk7XG4gICAgICAgICAgICAgICAgdmFyIHZhbCA9IFwicmdiYShcIiArIHJfdmFsICsgXCIsXCIgKyBnX3ZhbCArIFwiLFwiICsgYl92YWwgKyBcIixcIiArIGFfdmFsICsgXCIpXCI7XG4gICAgICAgICAgICAgICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhcImNvbG9yOiBcIiwgdmFsKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhzbChcbiAgICBoOiBudW1iZXIgfCBQYXJhbWV0ZXI8bnVtYmVyPixcbiAgICBzOiBudW1iZXIgfCBQYXJhbWV0ZXI8bnVtYmVyPixcbiAgICBsOiBudW1iZXIgfCBQYXJhbWV0ZXI8bnVtYmVyPlxuKTogUGFyYW1ldGVyPENvbG9yPlxue1xuICAgIHJldHVybiBuZXcgUGFyYW1ldGVyKFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgaF9uZXh0ID0gZnJvbShoKS5pbml0KCk7XG4gICAgICAgICAgICB2YXIgc19uZXh0ID0gZnJvbShzKS5pbml0KCk7XG4gICAgICAgICAgICB2YXIgbF9uZXh0ID0gZnJvbShsKS5pbml0KCk7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odDogbnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGhfdmFsID0gTWF0aC5mbG9vcihoX25leHQodCkpO1xuICAgICAgICAgICAgICAgIHZhciBzX3ZhbCA9IE1hdGguZmxvb3Ioc19uZXh0KHQpKTtcbiAgICAgICAgICAgICAgICB2YXIgbF92YWwgPSBNYXRoLmZsb29yKGxfbmV4dCh0KSk7XG4gICAgICAgICAgICAgICAgdmFyIHZhbCA9IFwiaHNsKFwiICsgaF92YWwgKyBcIixcIiArIHNfdmFsICsgXCIlLFwiICsgbF92YWwgKyBcIiUpXCI7XG4gICAgICAgICAgICAgICAgLy8gaWYgKERFQlVHKSBjb25zb2xlLmxvZyhcImhzbDogXCIsIHZhbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0KCk6IFBhcmFtZXRlcjxudW1iZXI+IHtcbiAgICByZXR1cm4gbmV3IFBhcmFtZXRlcihcbiAgICAgICAgKCkgPT4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHJldHVybiB0O1xuICAgICAgICB9XG4gICAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJuZCgpOiBQYXJhbWV0ZXI8bnVtYmVyPiB7XG4gICAgcmV0dXJuIG5ldyBQYXJhbWV0ZXIoXG4gICAgICAgICgpID0+IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5yYW5kb20oKTtcbiAgICAgICAgfVxuICAgICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb25zdGFudDxUPih2YWw6IFQpOiBQYXJhbWV0ZXI8VD4ge1xuICAgIHJldHVybiBuZXcgUGFyYW1ldGVyKFxuICAgICAgICAoKSA9PiBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgcmV0dXJuIHZhbDtcbiAgICAgICAgfVxuICAgICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBybmROb3JtYWwoc2NhbGUgOiBQYXJhbWV0ZXI8bnVtYmVyPiB8IG51bWJlciA9IDEpOiBQYXJhbWV0ZXI8UG9pbnQ+IHtcbiAgICByZXR1cm4gbmV3IFBhcmFtZXRlcjxQb2ludD4oXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coXCJybmROb3JtYWw6IGluaXRcIik7XG4gICAgICAgICAgICB2YXIgc2NhbGVfbmV4dCA9IGZyb20oc2NhbGUpLmluaXQoKTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodDogbnVtYmVyKTogUG9pbnQge1xuICAgICAgICAgICAgICAgIHZhciBzY2FsZSA9IHNjYWxlX25leHQodCk7XG4gICAgICAgICAgICAgICAgLy8gZ2VuZXJhdGUgcmFuZG9tIG51bWJlcnNcbiAgICAgICAgICAgICAgICB2YXIgbm9ybTIgPSAxMDA7XG4gICAgICAgICAgICAgICAgd2hpbGUgKG5vcm0yID4gMSkgeyAvL3JlamVjdCB0aG9zZSBvdXRzaWRlIHRoZSB1bml0IGNpcmNsZVxuICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDI7XG4gICAgICAgICAgICAgICAgICAgIHZhciB5ID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMjtcbiAgICAgICAgICAgICAgICAgICAgbm9ybTIgPSB4ICogeCArIHkgKiB5O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBub3JtID0gTWF0aC5zcXJ0KG5vcm0yKTtcbiAgICAgICAgICAgICAgICB2YXIgdmFsOiBbbnVtYmVyLCBudW1iZXJdID0gW3NjYWxlICogeCAvIG5vcm0gLCBzY2FsZSAqIHkgLyBub3JtXTtcbiAgICAgICAgICAgICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKFwicm5kTm9ybWFsOiB2YWxcIiwgdmFsKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgKTtcbn1cblxuXG4vL3RvZG86IHNob3VsZCBiZSB0IGFzIGEgcGFyYW1ldGVyIHRvIGEgbm9uIHRlbXBvclxuZXhwb3J0IGZ1bmN0aW9uIHNpbihwZXJpb2Q6IE51bWJlckFyZyk6IFBhcmFtZXRlcjxudW1iZXI+IHtcbiAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKFwic2luOiBuZXdcIik7XG4gICAgcmV0dXJuIG5ldyBQYXJhbWV0ZXIoXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICAgIHZhciBwZXJpb2RfbmV4dCA9IGZyb20ocGVyaW9kKS5pbml0KCk7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQ6IG51bWJlcikge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IE1hdGguc2luKHQgKiAoTWF0aC5QSSAqIDIpIC8gcGVyaW9kX25leHQodCkpO1xuICAgICAgICAgICAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coXCJzaW46IHRpY2tcIiwgdCwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG59XG5leHBvcnQgZnVuY3Rpb24gY29zKHBlcmlvZDogbnVtYmVyfCBQYXJhbWV0ZXI8bnVtYmVyPik6IFBhcmFtZXRlcjxudW1iZXI+IHtcbiAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKFwiY29zOiBuZXdcIik7XG4gICAgcmV0dXJuIG5ldyBQYXJhbWV0ZXIoXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICAgIHZhciBwZXJpb2RfbmV4dCA9IGZyb20ocGVyaW9kKS5pbml0KCk7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQ6IG51bWJlcikge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IE1hdGguY29zKHQgKiAoTWF0aC5QSSAqIDIpIC8gcGVyaW9kX25leHQodCkpO1xuICAgICAgICAgICAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coXCJjb3M6IHRpY2tcIiwgdCwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG59XG5cblxuXG5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
