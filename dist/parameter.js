exports.DEBUG = false;
var Parameter = (function () {
    /**
     * Before a parameter is used, the enclosing animation must call init. This returns a function which
     * can be used to find the value of the function for specific values of time.
     */
    function Parameter(init) {
        this.init = init;
    }
    /**
     * Before a parameter is used, the enclosing animation must call init. This returns a function which
     * can be used to find the value of the function for specific values of time.
     */
    Parameter.prototype.init = function () { throw new Error('This method is abstract'); };
    /**
     * map the value of 'this' to a new parameter
     */
    Parameter.prototype.map = function (fn) {
        var base = this;
        return new Parameter(function () {
            var base_next = base.init();
            return function (t) {
                return fn(base_next(t));
            };
        });
    };
    /**
     * Returns a parameter whose value is forever the first value next picked from this.
     * @returns {Parameter<T>}
     */
    Parameter.prototype.first = function () {
        var self = this;
        return new Parameter(function () {
            var generate = true;
            var next = self.init();
            var value = null;
            return function (clock) {
                if (generate) {
                    generate = false;
                    value = next(clock);
                }
                // console.log("fixed: val from parameter", value);
                return value;
            };
        });
    };
    return Parameter;
})();
exports.Parameter = Parameter;
function from(source) {
    if (typeof source.init == 'function')
        return source;
    else
        return constant(source);
}
exports.from = from;
function point(x, y) {
    return new Parameter(function () {
        var x_next = from(x).init();
        var y_next = from(y).init();
        return function (t) {
            var result = [x_next(t), y_next(t)];
            //if (DEBUG) console.log("point: next", result);
            return result;
        };
    });
}
exports.point = point;
function displaceT(displacement, value) {
    return new Parameter(function () {
        var dt_next = from(displacement).init();
        var value_next = from(value).init();
        return function (t) {
            var dt = dt_next(t);
            if (exports.DEBUG)
                console.log("displaceT: ", dt);
            return value_next(t + dt);
        };
    });
}
exports.displaceT = displaceT;
/*
    RGB between 0 and 255
    a between 0 - 1
 */
function rgba(r, g, b, a) {
    return new Parameter(function () {
        var r_next = from(r).init();
        var g_next = from(g).init();
        var b_next = from(b).init();
        var a_next = from(a).init();
        return function (t) {
            var r_val = Math.floor(r_next(t));
            var g_val = Math.floor(g_next(t));
            var b_val = Math.floor(b_next(t));
            var a_val = a_next(t);
            var val = "rgba(" + r_val + "," + g_val + "," + b_val + "," + a_val + ")";
            if (exports.DEBUG)
                console.log("color: ", val);
            return val;
        };
    });
}
exports.rgba = rgba;
function hsl(h, s, l) {
    return new Parameter(function () {
        var h_next = from(h).init();
        var s_next = from(s).init();
        var l_next = from(l).init();
        return function (t) {
            var h_val = Math.floor(h_next(t));
            var s_val = Math.floor(s_next(t));
            var l_val = Math.floor(l_next(t));
            var val = "hsl(" + h_val + "," + s_val + "%," + l_val + "%)";
            // if (DEBUG) console.log("hsl: ", val);
            return val;
        };
    });
}
exports.hsl = hsl;
function t() {
    return new Parameter(function () { return function (t) {
        return t;
    }; });
}
exports.t = t;
function rnd() {
    return new Parameter(function () { return function (t) {
        return Math.random();
    }; });
}
exports.rnd = rnd;
function constant(val) {
    return new Parameter(function () { return function (t) {
        return val;
    }; });
}
exports.constant = constant;
function rndNormal(scale) {
    if (scale === void 0) { scale = 1; }
    return new Parameter(function () {
        if (exports.DEBUG)
            console.log("rndNormal: init");
        var scale_next = from(scale).init();
        return function (t) {
            var scale = scale_next(t);
            // generate random numbers
            var norm2 = 100;
            while (norm2 > 1) {
                var x = (Math.random() - 0.5) * 2;
                var y = (Math.random() - 0.5) * 2;
                norm2 = x * x + y * y;
            }
            var norm = Math.sqrt(norm2);
            var val = [scale * x / norm, scale * y / norm];
            if (exports.DEBUG)
                console.log("rndNormal: val", val);
            return val;
        };
    });
}
exports.rndNormal = rndNormal;
//todo: should be t as a parameter to a non tempor
function sin(period) {
    if (exports.DEBUG)
        console.log("sin: new");
    return new Parameter(function () {
        var period_next = from(period).init();
        return function (t) {
            var value = Math.sin(t * (Math.PI * 2) / period_next(t));
            if (exports.DEBUG)
                console.log("sin: tick", t, value);
            return value;
        };
    });
}
exports.sin = sin;
function cos(period) {
    if (exports.DEBUG)
        console.log("cos: new");
    return new Parameter(function () {
        var period_next = from(period).init();
        return function (t) {
            var value = Math.cos(t * (Math.PI * 2) / period_next(t));
            if (exports.DEBUG)
                console.log("cos: tick", t, value);
            return value;
        };
    });
}
exports.cos = cos;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcmFtZXRlci50cyJdLCJuYW1lcyI6WyJQYXJhbWV0ZXIiLCJQYXJhbWV0ZXIuY29uc3RydWN0b3IiLCJQYXJhbWV0ZXIuaW5pdCIsIlBhcmFtZXRlci5tYXAiLCJQYXJhbWV0ZXIuZmlyc3QiLCJmcm9tIiwicG9pbnQiLCJkaXNwbGFjZVQiLCJyZ2JhIiwiaHNsIiwidCIsInJuZCIsImNvbnN0YW50Iiwicm5kTm9ybWFsIiwic2luIiwiY29zIl0sIm1hcHBpbmdzIjoiQUFJVyxhQUFLLEdBQUcsS0FBSyxDQUFDO0FBU3pCO0lBQ0lBOzs7T0FHR0E7SUFDSEEsbUJBQVlBLElBQXNDQTtRQUM5Q0MsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7SUFDckJBLENBQUNBO0lBRUREOzs7T0FHR0E7SUFDSEEsd0JBQUlBLEdBQUpBLGNBQWtDRSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSx5QkFBeUJBLENBQUNBLENBQUNBLENBQUFBLENBQUNBO0lBRTlFRjs7T0FFR0E7SUFDSEEsdUJBQUdBLEdBQUhBLFVBQU9BLEVBQWdCQTtRQUNuQkcsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDaEJBLE1BQU1BLENBQUNBLElBQUlBLFNBQVNBLENBQ2hCQTtZQUNJQSxJQUFJQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQTtZQUM1QkEsTUFBTUEsQ0FBQ0EsVUFBU0EsQ0FBQ0E7Z0JBQ2IsTUFBTSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QixDQUFDLENBQUFBO1FBQ0xBLENBQUNBLENBQ0pBLENBQUNBO0lBQ05BLENBQUNBO0lBQ0RIOzs7T0FHR0E7SUFDSEEseUJBQUtBLEdBQUxBO1FBQ0lJLElBQUlBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQ2hCQSxNQUFNQSxDQUFDQSxJQUFJQSxTQUFTQSxDQUNoQkE7WUFDSUEsSUFBSUEsUUFBUUEsR0FBR0EsSUFB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QUNBO0lBQ25DQSxNQUFNQSxDQUFDQSxJQUFJQSxTQUFTQSxDQUNoQkE7UUFDSUEsSUFBSUEsV0FBV0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0E7UUFDdENBLE1BQU1BLENBQUNBLFVBQVVBLENBQVNBO1lBQ3RCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6RCxFQUFFLENBQUMsQ0FBQyxhQUFLLENBQUM7Z0JBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDakIsQ0FBQyxDQUFBQTtJQUNMQSxDQUFDQSxDQUNKQSxDQUFDQTtBQUNOQSxDQUFDQTtBQVplLFdBQUcsTUFZbEIsQ0FBQSIsImZpbGUiOiJwYXJhbWV0ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vbm9kZV9tb2R1bGVzL3J4L3RzL3J4LmFsbC5kLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBlcy9ub2RlLmQudHNcIiAvPlxuaW1wb3J0IFJ4ID0gcmVxdWlyZSgncngnKTtcblxuZXhwb3J0IHZhciBERUJVRyA9IGZhbHNlO1xuXG4vLyB0b2RvIHRoZXNlIGNob3VsZCBiZSBwdXQgaW4gdHlwZXMgRVM2IG1vZHVsZSBidXQgbXkgSURFIGRvZXMgbm90IHN1cHBvcnQgaXQgeWV0IChweWNoYXJtKVxuZXhwb3J0IHR5cGUgQ29sb3IgPSBzdHJpbmdcbmV4cG9ydCB0eXBlIFBvaW50ICAgICA9IFtudW1iZXIsIG51bWJlcl1cbmV4cG9ydCB0eXBlIE51bWJlckFyZyA9IG51bWJlciB8IFBhcmFtZXRlcjxudW1iZXI+XG5leHBvcnQgdHlwZSBQb2ludEFyZyAgPSBQb2ludCB8IFBhcmFtZXRlcjxQb2ludD5cblxuXG5leHBvcnQgY2xhc3MgUGFyYW1ldGVyPFZhbHVlPiB7XG4gICAgLyoqXG4gICAgICogQmVmb3JlIGEgcGFyYW1ldGVyIGlzIHVzZWQsIHRoZSBlbmNsb3NpbmcgYW5pbWF0aW9uIG11c3QgY2FsbCBpbml0LiBUaGlzIHJldHVybnMgYSBmdW5jdGlvbiB3aGljaFxuICAgICAqIGNhbiBiZSB1c2VkIHRvIGZpbmQgdGhlIHZhbHVlIG9mIHRoZSBmdW5jdGlvbiBmb3Igc3BlY2lmaWMgdmFsdWVzIG9mIHRpbWUuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoaW5pdDogKCkgPT4gKChjbG9jazogbnVtYmVyKSA9PiBWYWx1ZSkpIHtcbiAgICAgICAgdGhpcy5pbml0ID0gaW5pdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBCZWZvcmUgYSBwYXJhbWV0ZXIgaXMgdXNlZCwgdGhlIGVuY2xvc2luZyBhbmltYXRpb24gbXVzdCBjYWxsIGluaXQuIFRoaXMgcmV0dXJucyBhIGZ1bmN0aW9uIHdoaWNoXG4gICAgICogY2FuIGJlIHVzZWQgdG8gZmluZCB0aGUgdmFsdWUgb2YgdGhlIGZ1bmN0aW9uIGZvciBzcGVjaWZpYyB2YWx1ZXMgb2YgdGltZS5cbiAgICAgKi9cbiAgICBpbml0KCk6IChjbG9jazogbnVtYmVyKSA9PiBWYWx1ZSB7dGhyb3cgbmV3IEVycm9yKCdUaGlzIG1ldGhvZCBpcyBhYnN0cmFjdCcpO31cblxuICAgIC8qKlxuICAgICAqIG1hcCB0aGUgdmFsdWUgb2YgJ3RoaXMnIHRvIGEgbmV3IHBhcmFtZXRlclxuICAgICAqL1xuICAgIG1hcDxWPihmbjogKFZhbHVlKSA9PiBWKTogUGFyYW1ldGVyPFY+IHtcbiAgICAgICAgdmFyIGJhc2UgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFBhcmFtZXRlcihcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgYmFzZV9uZXh0ID0gYmFzZS5pbml0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZuKGJhc2VfbmV4dCh0KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgcGFyYW1ldGVyIHdob3NlIHZhbHVlIGlzIGZvcmV2ZXIgdGhlIGZpcnN0IHZhbHVlIG5leHQgcGlja2VkIGZyb20gdGhpcy5cbiAgICAgKiBAcmV0dXJucyB7UGFyYW1ldGVyPFQ+fVxuICAgICAqL1xuICAgIGZpcnN0KCk6IFBhcmFtZXRlcjxWYWx1ZT4ge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUGFyYW1ldGVyPFZhbHVlPihcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgZ2VuZXJhdGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHZhciBuZXh0ID0gc2VsZi5pbml0KCk7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gbnVsbDtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGNsb2NrOiBudW1iZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdlbmVyYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBuZXh0KGNsb2NrKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImZpeGVkOiB2YWwgZnJvbSBwYXJhbWV0ZXJcIiwgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxufVxuXG5cbmV4cG9ydCBmdW5jdGlvbiBmcm9tPFQ+KHNvdXJjZTogVCB8IFBhcmFtZXRlcjxUPik6IFBhcmFtZXRlcjxUPiB7XG4gICAgaWYgKHR5cGVvZiAoPGFueT5zb3VyY2UpLmluaXQgPT0gJ2Z1bmN0aW9uJykgcmV0dXJuIDxQYXJhbWV0ZXI8VD4+c291cmNlO1xuICAgIGVsc2UgcmV0dXJuIGNvbnN0YW50KDxUPiBzb3VyY2UpXG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIHBvaW50KFxuICAgIHg6IG51bWJlciB8IFBhcmFtZXRlcjxudW1iZXI+LFxuICAgIHk6IG51bWJlciB8IFBhcmFtZXRlcjxudW1iZXI+XG4pOiBQYXJhbWV0ZXI8UG9pbnQ+XG57ICAgLy9pZiAoREVCVUcpIGNvbnNvbGUubG9nKFwicG9pbnQ6IGluaXRcIiwgeF9zdHJlYW0sIHlfc3RyZWFtKTtcbiAgICByZXR1cm4gbmV3IFBhcmFtZXRlcihcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIHhfbmV4dCA9IGZyb20oeCkuaW5pdCgpO1xuICAgICAgICAgICAgdmFyIHlfbmV4dCA9IGZyb20oeSkuaW5pdCgpO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQ6IG51bWJlcikge1xuICAgICAgICAgICAgICAgIHZhciByZXN1bHQ6IFtudW1iZXIsIG51bWJlcl0gPSBbeF9uZXh0KHQpLCB5X25leHQodCldO1xuICAgICAgICAgICAgICAgIC8vaWYgKERFQlVHKSBjb25zb2xlLmxvZyhcInBvaW50OiBuZXh0XCIsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGRpc3BsYWNlVDxUPihkaXNwbGFjZW1lbnQ6IE51bWJlckFyZywgdmFsdWU6IFQgfCBQYXJhbWV0ZXI8VD4pOiBQYXJhbWV0ZXI8VD4ge1xuICAgIHJldHVybiBuZXcgUGFyYW1ldGVyPFQ+IChcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIGR0X25leHQgICAgPSBmcm9tKGRpc3BsYWNlbWVudCkuaW5pdCgpO1xuICAgICAgICAgICAgdmFyIHZhbHVlX25leHQgPSBmcm9tKHZhbHVlKS5pbml0KCk7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZHQgPSBkdF9uZXh0KHQpO1xuICAgICAgICAgICAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coXCJkaXNwbGFjZVQ6IFwiLCBkdCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlX25leHQodCArIGR0KVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgKVxufVxuXG4vKlxuICAgIFJHQiBiZXR3ZWVuIDAgYW5kIDI1NVxuICAgIGEgYmV0d2VlbiAwIC0gMVxuICovXG5leHBvcnQgZnVuY3Rpb24gcmdiYShcbiAgICByOiBudW1iZXIgfCBQYXJhbWV0ZXI8bnVtYmVyPixcbiAgICBnOiBudW1iZXIgfCBQYXJhbWV0ZXI8bnVtYmVyPixcbiAgICBiOiBudW1iZXIgfCBQYXJhbWV0ZXI8bnVtYmVyPixcbiAgICBhOiBudW1iZXIgfCBQYXJhbWV0ZXI8bnVtYmVyPlxuKTogUGFyYW1ldGVyPENvbG9yPlxue1xuICAgIHJldHVybiBuZXcgUGFyYW1ldGVyKFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgcl9uZXh0ID0gZnJvbShyKS5pbml0KCk7XG4gICAgICAgICAgICB2YXIgZ19uZXh0ID0gZnJvbShnKS5pbml0KCk7XG4gICAgICAgICAgICB2YXIgYl9uZXh0ID0gZnJvbShiKS5pbml0KCk7XG4gICAgICAgICAgICB2YXIgYV9uZXh0ID0gZnJvbShhKS5pbml0KCk7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odDogbnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJfdmFsID0gTWF0aC5mbG9vcihyX25leHQodCkpO1xuICAgICAgICAgICAgICAgIHZhciBnX3ZhbCA9IE1hdGguZmxvb3IoZ19uZXh0KHQpKTtcbiAgICAgICAgICAgICAgICB2YXIgYl92YWwgPSBNYXRoLmZsb29yKGJfbmV4dCh0KSk7XG4gICAgICAgICAgICAgICAgdmFyIGFfdmFsID0gYV9uZXh0KHQpO1xuICAgICAgICAgICAgICAgIHZhciB2YWwgPSBcInJnYmEoXCIgKyByX3ZhbCArIFwiLFwiICsgZ192YWwgKyBcIixcIiArIGJfdmFsICsgXCIsXCIgKyBhX3ZhbCArIFwiKVwiO1xuICAgICAgICAgICAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coXCJjb2xvcjogXCIsIHZhbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoc2woXG4gICAgaDogbnVtYmVyIHwgUGFyYW1ldGVyPG51bWJlcj4sXG4gICAgczogbnVtYmVyIHwgUGFyYW1ldGVyPG51bWJlcj4sXG4gICAgbDogbnVtYmVyIHwgUGFyYW1ldGVyPG51bWJlcj5cbik6IFBhcmFtZXRlcjxDb2xvcj5cbntcbiAgICByZXR1cm4gbmV3IFBhcmFtZXRlcihcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgdmFyIGhfbmV4dCA9IGZyb20oaCkuaW5pdCgpO1xuICAgICAgICAgICAgdmFyIHNfbmV4dCA9IGZyb20ocykuaW5pdCgpO1xuICAgICAgICAgICAgdmFyIGxfbmV4dCA9IGZyb20obCkuaW5pdCgpO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQ6IG51bWJlcikge1xuICAgICAgICAgICAgICAgIHZhciBoX3ZhbCA9IE1hdGguZmxvb3IoaF9uZXh0KHQpKTtcbiAgICAgICAgICAgICAgICB2YXIgc192YWwgPSBNYXRoLmZsb29yKHNfbmV4dCh0KSk7XG4gICAgICAgICAgICAgICAgdmFyIGxfdmFsID0gTWF0aC5mbG9vcihsX25leHQodCkpO1xuICAgICAgICAgICAgICAgIHZhciB2YWwgPSBcImhzbChcIiArIGhfdmFsICsgXCIsXCIgKyBzX3ZhbCArIFwiJSxcIiArIGxfdmFsICsgXCIlKVwiO1xuICAgICAgICAgICAgICAgIC8vIGlmIChERUJVRykgY29uc29sZS5sb2coXCJoc2w6IFwiLCB2YWwpO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdCgpOiBQYXJhbWV0ZXI8bnVtYmVyPiB7XG4gICAgcmV0dXJuIG5ldyBQYXJhbWV0ZXIoXG4gICAgICAgICgpID0+IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgfVxuICAgICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBybmQoKTogUGFyYW1ldGVyPG51bWJlcj4ge1xuICAgIHJldHVybiBuZXcgUGFyYW1ldGVyKFxuICAgICAgICAoKSA9PiBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKCk7XG4gICAgICAgIH1cbiAgICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29uc3RhbnQ8VD4odmFsOiBUKTogUGFyYW1ldGVyPFQ+IHtcbiAgICByZXR1cm4gbmV3IFBhcmFtZXRlcihcbiAgICAgICAgKCkgPT4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHJldHVybiB2YWw7XG4gICAgICAgIH1cbiAgICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcm5kTm9ybWFsKHNjYWxlIDogUGFyYW1ldGVyPG51bWJlcj4gfCBudW1iZXIgPSAxKTogUGFyYW1ldGVyPFBvaW50PiB7XG4gICAgcmV0dXJuIG5ldyBQYXJhbWV0ZXI8UG9pbnQ+KFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKFwicm5kTm9ybWFsOiBpbml0XCIpO1xuICAgICAgICAgICAgdmFyIHNjYWxlX25leHQgPSBmcm9tKHNjYWxlKS5pbml0KCk7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQ6IG51bWJlcik6IFBvaW50IHtcbiAgICAgICAgICAgICAgICB2YXIgc2NhbGUgPSBzY2FsZV9uZXh0KHQpO1xuICAgICAgICAgICAgICAgIC8vIGdlbmVyYXRlIHJhbmRvbSBudW1iZXJzXG4gICAgICAgICAgICAgICAgdmFyIG5vcm0yID0gMTAwO1xuICAgICAgICAgICAgICAgIHdoaWxlIChub3JtMiA+IDEpIHsgLy9yZWplY3QgdGhvc2Ugb3V0c2lkZSB0aGUgdW5pdCBjaXJjbGVcbiAgICAgICAgICAgICAgICAgICAgdmFyIHggPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAyO1xuICAgICAgICAgICAgICAgICAgICB2YXIgeSA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDI7XG4gICAgICAgICAgICAgICAgICAgIG5vcm0yID0geCAqIHggKyB5ICogeTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgbm9ybSA9IE1hdGguc3FydChub3JtMik7XG4gICAgICAgICAgICAgICAgdmFyIHZhbDogW251bWJlciwgbnVtYmVyXSA9IFtzY2FsZSAqIHggLyBub3JtICwgc2NhbGUgKiB5IC8gbm9ybV07XG4gICAgICAgICAgICAgICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhcInJuZE5vcm1hbDogdmFsXCIsIHZhbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG59XG5cblxuLy90b2RvOiBzaG91bGQgYmUgdCBhcyBhIHBhcmFtZXRlciB0byBhIG5vbiB0ZW1wb3JcbmV4cG9ydCBmdW5jdGlvbiBzaW4ocGVyaW9kOiBOdW1iZXJBcmcpOiBQYXJhbWV0ZXI8bnVtYmVyPiB7XG4gICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhcInNpbjogbmV3XCIpO1xuICAgIHJldHVybiBuZXcgUGFyYW1ldGVyKFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgcGVyaW9kX25leHQgPSBmcm9tKHBlcmlvZCkuaW5pdCgpO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0OiBudW1iZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBNYXRoLnNpbih0ICogKE1hdGguUEkgKiAyKSAvIHBlcmlvZF9uZXh0KHQpKTtcbiAgICAgICAgICAgICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKFwic2luOiB0aWNrXCIsIHQsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICApO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNvcyhwZXJpb2Q6IG51bWJlcnwgUGFyYW1ldGVyPG51bWJlcj4pOiBQYXJhbWV0ZXI8bnVtYmVyPiB7XG4gICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhcImNvczogbmV3XCIpO1xuICAgIHJldHVybiBuZXcgUGFyYW1ldGVyKFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgcGVyaW9kX25leHQgPSBmcm9tKHBlcmlvZCkuaW5pdCgpO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0OiBudW1iZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBNYXRoLmNvcyh0ICogKE1hdGguUEkgKiAyKSAvIHBlcmlvZF9uZXh0KHQpKTtcbiAgICAgICAgICAgICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKFwiY29zOiB0aWNrXCIsIHQsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICApO1xufVxuXG5cblxuXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
